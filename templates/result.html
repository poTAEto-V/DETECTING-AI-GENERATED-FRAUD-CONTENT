<!DOCTYPE html>
<html>
<head>
    <title>Fraud Result</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="card">

    <h2>Fraud Analysis Result</h2>

    <p><b>Message:</b></p>
    <p>{{ message }}</p>

    <hr>

    <p><b>Risk Score:</b> {{ score }}</p>

    <!-- FRAUD METER -->
    <div class="meter-box">

        <div class="meter-label">
            Fraud Risk Meter: {{ score }}/100
        </div>

        <div class="meter">
            <div class="meter-fill
            {% if score >=75 %}critical-fill
            {% elif score >=50 %}high-fill
            {% elif score >=25 %}medium-fill
            {% else %}safe-fill{% endif %}"
            style="width: {{ score }}%;">
            </div>
        </div>

    </div>

    <p><b>Status:</b>
    <span class="
    {% if score >=75 %}critical
    {% elif score >=50 %}high
    {% elif score >=25 %}medium
    {% else %}safe{% endif %}
    ">
    {{ level }}
    </span>
    </p>

    <p><b>AI Probability:</b> {{ ai_prob }}%</p>

    <h3>AI Explanation</h3>
    <p>{{ explanation }}</p>

    <h3>Reasons Detected</h3>
    <ul>
        {% for r in reasons %}
            <li>{{ r }}</li>
        {% endfor %}
    </ul>

    <h3>Suspicious Words</h3>
    <ul>
        {% for w in words %}
            <li>{{ w }}</li>
        {% endfor %}
    </ul>

    <h3>Credentials Found</h3>
    <ul>
        {% for c in creds %}
            <li>{{ c }}</li>
        {% endfor %}
    </ul>

    <h3>URL Alerts</h3>
    <ul>
        {% for u in urls %}
            <li>{{ u }}</li>
        {% endfor %}
    </ul>

    <button onclick="sendEmail()">Email Report</button>

    <br><br>

    <a href="/">
        <button>â¬… Analyze Another Message</button>
    </a>

</div>

<script>

/* SAVE HISTORY */
let entry={
text:`{{message}}`.trim(),
score:Number("{{score}}"),
level:`{{level}}`
};

let history=JSON.parse(localStorage.getItem("fraudHistory")||"[]");

/* remove duplicates */
history=history.filter(h=>h.text!==entry.text);

/* newest top */
history.unshift(entry);

/* keep only last 8 */
history=history.slice(0,8);

localStorage.setItem("fraudHistory",JSON.stringify(history));


/* EMAIL REPORT */
function sendEmail(){

let body=`Message: {{message}}

Risk Score: {{score}}
Status: {{level}}

{{explanation}}`;

window.location.href=
`mailto:?subject=Fraud Report&body=${encodeURIComponent(body)}`;

}

</script>

</body>
</html>
